# Umi

## ä»‹ç»
### What
Umiï¼Œå¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æ¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚
ç„¶åé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚

### Why
å®ƒä¸»è¦å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š
- ğŸ‰ å¯æ‰©å±•ï¼ŒUmi å®ç°äº†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä½¿å…¶æ’ä»¶åŒ–ï¼ŒUmi å†…éƒ¨åŠŸèƒ½ä¹Ÿå…¨ç”±æ’ä»¶å®Œæˆã€‚æ­¤å¤–è¿˜æ”¯æŒæ’ä»¶å’Œæ’ä»¶é›†ï¼Œä»¥æ»¡è¶³åŠŸèƒ½å’Œå‚ç›´åŸŸçš„åˆ†å±‚éœ€æ±‚ã€‚
- ğŸ“¦ å¼€ç®±å³ç”¨ï¼ŒUmi å†…ç½®äº†è·¯ç”±ã€æ„å»ºã€éƒ¨ç½²ã€æµ‹è¯•ç­‰ï¼Œä»…éœ€ä¸€ä¸ªä¾èµ–å³å¯ä¸Šæ‰‹å¼€å‘ã€‚å¹¶ä¸”è¿˜æä¾›é’ˆå¯¹ React çš„é›†æˆæ’ä»¶é›†ï¼Œå†…æ¶µä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¯æ»¡è¶³æ—¥å¸¸ 80% çš„å¼€å‘éœ€æ±‚ã€‚
- ğŸ  ä¼ä¸šçº§ï¼Œç»èš‚èšå†…éƒ¨ 3000+ é¡¹ç›®ä»¥åŠé˜¿é‡Œã€ä¼˜é…·ã€ç½‘æ˜“ã€é£çŒªã€å£ç¢‘ç­‰å…¬å¸é¡¹ç›®çš„éªŒè¯ï¼Œå€¼å¾—ä¿¡èµ–ã€‚
- ğŸš€ å¤§é‡è‡ªç ”ï¼ŒåŒ…å«å¾®å‰ç«¯ã€ç»„ä»¶æ‰“åŒ…ã€æ–‡æ¡£å·¥å…·ã€è¯·æ±‚åº“ã€hooks åº“ã€æ•°æ®æµç­‰ï¼Œæ»¡è¶³æ—¥å¸¸é¡¹ç›®çš„å‘¨è¾¹éœ€æ±‚ã€‚
- ğŸŒ´ å®Œå¤‡è·¯ç”±ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼ŒåŒæ—¶ä¿æŒåŠŸèƒ½çš„å®Œå¤‡æ€§ï¼Œæ¯”å¦‚åŠ¨æ€è·¯ç”±ã€åµŒå¥—è·¯ç”±ã€æƒé™è·¯ç”±ç­‰ç­‰ã€‚
- ğŸš„ é¢å‘æœªæ¥ï¼Œåœ¨æ»¡è¶³éœ€æ±‚çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šåœæ­¢å¯¹æ–°æŠ€æœ¯çš„æ¢ç´¢ã€‚æ¯”å¦‚ dll æé€Ÿã€modern modeã€webpack@5ã€è‡ªåŠ¨åŒ– externalã€bundler less ç­‰ç­‰ã€‚


### When
å¦‚æœä½ ï¼Œ

- éœ€è¦æ”¯æŒ IE 8 æˆ–æ›´ä½ç‰ˆæœ¬çš„æµè§ˆå™¨
- éœ€è¦æ”¯æŒ React 16.8.0 ä»¥ä¸‹çš„ React
- éœ€è¦è·‘åœ¨ Node 10 ä»¥ä¸‹çš„ç¯å¢ƒä¸­
- æœ‰å¾ˆå¼ºçš„ webpack è‡ªå®šä¹‰éœ€æ±‚å’Œä¸»è§‚æ„æ„¿
- éœ€è¦é€‰æ‹©ä¸åŒçš„è·¯ç”±æ–¹æ¡ˆ
Umi å¯èƒ½ä¸é€‚åˆä½ ã€‚


## ä¸Šæ‰‹
```
å»ºä¸ªç©ºç›®å½•
mkdir myapp && cd myapp
åˆ›å»ºé¡¹ç›®
yarn create @umijs/umi-app
å®‰è£…ä¾èµ–
yarn
å¯åŠ¨é¡¹ç›®
yarn start
```


## ç›®å½•ç»“æ„
```
â”œâ”€â”€ package.json
â”œâ”€â”€ .umirc.ts    é…ç½®æ–‡ä»¶ï¼ŒåŒ…å« umi å†…ç½®åŠŸèƒ½å’Œæ’ä»¶çš„é…ç½®ã€‚
â”œâ”€â”€ .env         ç¯å¢ƒå˜é‡
â”œâ”€â”€ dist         æ‰§è¡Œ umi build åï¼Œäº§ç‰©é»˜è®¤ä¼šå­˜æ”¾åœ¨è¿™é‡Œã€‚
â”œâ”€â”€ mock         å­˜å‚¨ mock æ–‡ä»¶ï¼Œæ­¤ç›®å½•ä¸‹æ‰€æœ‰ js å’Œ ts æ–‡ä»¶ä¼šè¢«è§£æä¸º mock æ–‡ä»¶ã€‚
â”œâ”€â”€ public       æ­¤ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¼šè¢« copy åˆ°è¾“å‡ºè·¯å¾„ã€‚
â””â”€â”€ src    
    â”œâ”€â”€ .umi     
    â”œâ”€â”€ layouts/index.tsx çº¦å®šå¼è·¯ç”±æ—¶çš„å…¨å±€å¸ƒå±€æ–‡ä»¶ã€‚    
    â”œâ”€â”€ pages             æ‰€æœ‰è·¯ç”±ç»„ä»¶å­˜æ”¾åœ¨è¿™é‡Œã€‚       
        â”œâ”€â”€ index.less        
        â””â”€â”€ index.tsx   
    â””â”€â”€ app.ts 
```
- src/.umi
ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œæ¯”å¦‚å…¥å£æ–‡ä»¶ã€è·¯ç”±ç­‰ï¼Œéƒ½ä¼šè¢«ä¸´æ—¶ç”Ÿæˆåˆ°è¿™é‡Œã€‚ä¸è¦æäº¤ .umi ç›®å½•åˆ° git ä»“åº“ï¼Œä»–ä»¬ä¼šåœ¨ umi dev å’Œ umi build æ—¶è¢«åˆ é™¤å¹¶é‡æ–°ç”Ÿæˆã€‚
- src/app.ts
è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰©å±•è¿è¡Œæ—¶çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ä¿®æ”¹è·¯ç”±ã€ä¿®æ”¹ render æ–¹æ³•ç­‰ã€‚

## è·¯ç”±
æ‰‹åŠ¨åˆ›å»ºæˆ–è€…ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚
å»ºç«‹pagesä¸‹é¢çš„å•é¡µé¢aboutï¼š
```
umi g page about
```

å»ºç«‹æ–‡ä»¶å¤¹more(é»˜è®¤æ˜¯jså’Œcss)ï¼š

```
umi g page more/index --typescript --less
```

- è®¿é—®index: http://localhost:8000/
- è®¿é—®about: http://localhost:8000/about

**é…ç½®è·¯ç”±**
è·¯ç”±é…ç½®è¯¦ç»†æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼šhttps://umijs.org/zh-CN/docs/routing

        
### çº¦å®šå¼è·¯ç”±
#### åŠ¨æ€è·¯ç”±
```
umi g page product/[id]
```

```js
import React from 'react';
import { IRouteComponentProps } from 'umi';
import styles from './[id].less';
export default (props: IRouteComponentProps) => {  
  console.log('product', props); //sy-log  
  return (    
    <div>      
      <h1 className={styles.title}>Page product/[id]</h1>
      </div>  
  );
};
```
è·¯ç”±é…ç½®
```js
{ path: '/product/:id', component: '@/pages/product/[id]' }
```




#### åŠ¨æ€å¯é€‰è·¯ç”±
è·¯ç”±é…ç½®å¯é€‰çš„åŠ¨æ€è·¯ç”±umi3æš‚ä¸æ”¯æŒï¼Œ


#### åµŒå¥—è·¯ç”±

Umi é‡Œçº¦å®šç›®å½•ä¸‹æœ‰_layout.tsxæ—¶ä¼šç”ŸæˆåµŒå¥—è·¯ç”±ï¼Œä»¥_layout.tsxä¸ºè¯¥ç›®å½•çš„ layoutã€‚layoutæ–‡ä»¶éœ€è¦è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡props.childrenæ¸²æŸ“å­ç»„ä»¶ã€‚

é¦–å…ˆåˆ›å»º_layout.js
```
umi g page product/_layout
```

çº¦å®šsrc/layouts/index.tsxä¸ºå…¨å±€è·¯ç”±ã€‚è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡props.childrenæ¸²æŸ“å­ç»„ä»¶ã€‚

æ¯”å¦‚ï¼š
```js
import React from 'react';
import { IRouteComponentProps } from 'umi';
export default (props: IRouteComponentProps) => {  
  console.log('product', props); //sy-log  
  return (    
    <div style={{ color: 'red' }}>     
      <h1>layout</h1>      
      {props.children}    
    </div>  
  );
}; 

```

é…ç½®è·¯ç”±ï¼š

```js
{      
  path: '/product/:id',      
  component: '@/pages/product/_layout',      
  routes: [{ path: '/product/:id', component: '@/pages/product/[id]' }],    }
```



#### å…¨å±€ layout
çº¦å®šsrc/layouts/index.tsxä¸ºå…¨å±€è·¯ç”±ã€‚è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡props.childrenæ¸²æŸ“å­ç»„ä»¶ã€‚

```js
import { IRouteComponentProps } from 'umi'

export default function Layout({ children, location, route, history, match }: IRouteComponentProps) {
  return children
}

```

### ä¸åŒçš„å…¨å±€ layout

ä½ å¯èƒ½éœ€è¦é’ˆå¯¹ä¸åŒè·¯ç”±è¾“å‡ºä¸åŒçš„å…¨å±€ layoutï¼ŒUmi ä¸æ”¯æŒè¿™æ ·çš„é…ç½®ï¼Œä½†ä½ ä»å¯ä»¥åœ¨src/layouts/index.tsxä¸­å¯¹location.pathåšåŒºåˆ†ï¼Œæ¸²æŸ“ä¸åŒçš„ layout ã€‚æ¯”å¦‚æƒ³è¦é’ˆå¯¹/loginè¾“å‡ºç®€å•å¸ƒå±€
```js
export default function(props) {
  if (props.location.pathname === '/login') {
    return <SimpleLayout>{ props.children }</SimpleLayout>
  }

  return (
    <>
      <Header />
      { props.children }
      <Footer />
    </>
  );
}

```


#### 404 è·¯ç”±
```js
umi g page 404/index --typescript --less
```
ç”Ÿæˆè·¯ç”±
```js
{ component: '@/pages/404' }
```

#### æ‰©å±•è·¯ç”±å±æ€§
æ”¯æŒåœ¨ä»£ç å±‚é€šè¿‡å¯¼å‡ºé™æ€å±æ€§çš„æ–¹å¼æ‰©å±•è·¯ç”±
```js
function HomePage() {
  return <h1>Home Page</h1>;
}
HomePage.title = 'Home Page';
export default HomePage;
```
å…¶ä¸­çš„ title ä¼šé™„åŠ åˆ°è·¯ç”±é…ç½®ä¸­ã€‚

## é¡µé¢è·³è½¬
åœ¨ umi é‡Œï¼Œé¡µé¢ä¹‹é—´è·³è½¬æœ‰ä¸¤ç§æ–¹å¼ï¼šå£°æ˜å¼å’Œå‘½ä»¤å¼ã€‚
### å£°æ˜å¼
é€šè¿‡ Link ä½¿ç”¨ï¼Œé€šå¸¸ä½œä¸º React ç»„ä»¶ä½¿ç”¨ã€‚
```js
import { Link } from 'umi';
export default () => (
  <Link to="/list">Go to list page</Link>
);
```

### å‘½ä»¤å¼
é€šè¿‡ history ä½¿ç”¨ï¼Œé€šå¸¸åœ¨äº‹ä»¶å¤„ç†ä¸­è¢«è°ƒç”¨ã€‚
```js
import { history } from 'umi';
function goToListPage() {
  history.push('/list');
}
```
ä¹Ÿå¯ä»¥ç›´æ¥ä»ç»„ä»¶çš„å±æ€§ä¸­å–å¾— history
```js
export default (props) => (
  <Button onClick={()=>props.history.push('/list');}>Go to list page</Button>
)
```


## æŒ‰éœ€åŠ è½½
ä¸ºäº†ç®€åŒ–éƒ¨ç½²æˆæœ¬ï¼ŒæŒ‰éœ€åŠ è½½åŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ï¼Œä½ éœ€è¦åœ¨ä½¿ç”¨ä¹‹å‰å…ˆé€šè¿‡é…ç½®å¼€å¯ï¼Œ
```js
export default {
  dynamicImport: {},
}
```
### æŒ‰éœ€åŠ è½½ç»„ä»¶ dynamic
é€šè¿‡ Umi çš„dynamicæ¥å£å®ç°
```js
import { dynamic } from 'umi';
const delay = (timeout) => new Promise(resolve => setTimeout(resolve, timeout));
const App = dynamic({  
  loader: async function() {    
    await delay(/* 1s */1000);    
    return () => <div>I will render after 1s</div>;  
  },
});
```
å°è£…ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶
```js
import { dynamic } from 'umi';
export default dynamic({
  loader: async function() {
    // è¿™é‡Œçš„æ³¨é‡Š webpackChunkName å¯ä»¥æŒ‡å¯¼ webpack å°†è¯¥ç»„ä»¶ HugeA ä»¥è¿™ä¸ªåå­—å•ç‹¬æ‹†å‡ºå»
    const { default: HugeA } = await import(/* webpackChunkName: "external_A" */ './HugeA');
    return HugeA;
  },
});
```
ä½¿ç”¨å¼‚æ­¥ç»„ä»¶
```js
import React from 'react';
import AsyncHugeA from './AsyncHugeA';
// åƒä½¿ç”¨æ™®é€šç»„ä»¶ä¸€æ ·å³å¯
// dynamic ä¸ºä½ åš:
// 1. å¼‚æ­¥åŠ è½½è¯¥æ¨¡å—çš„ bundle
// 2. åŠ è½½æœŸé—´ æ˜¾ç¤º loadingï¼ˆå¯å®šåˆ¶ï¼‰
// 3. å¼‚æ­¥ç»„ä»¶åŠ è½½å®Œæ¯•åï¼Œæ˜¾ç¤ºå¼‚æ­¥ç»„ä»¶
export default () => {
  return <AsyncHugeA />;
}
```

### æŒ‰éœ€åŠ è½½éç»„ä»¶
é€šè¿‡import()å®ç°
```js
import('g2').then(() => { 
   // do something with g2
});
```


